<img src="https://github.com/ERMPeru/elecciones2016/raw/master/headerLogo.png" width="1000">


## Análisis de Promulgación de Leyes en el Congreso Peruano

#### Elaborado por el [Laboratorio de Políticas Públicas de la PUCP](#team)

-----

```{r include=FALSE}
##Paquetes a instalar
library(stringr)
library(survival)
library(ggplot2)
library(tidyverse)
library(gridExtra)
library(DT)
library(tm)
library(wordcloud)
library(RColorBrewer)
library(ggpubr)
```

```{r include=FALSE}
seMean = function(x) sd(x)/sqrt(length(x))
```

```{r include=FALSE}
#cargar data
data=read.csv("dfall1.csv", stringsAsFactors = F)
```

```{r include=FALSE}
data=data[-1] #Elimino partido politico, ya tenemos grupo partidario 
names(data)
```

```{r include=FALSE}
#periodo Congreso
data$congresoR[data$congreso == names(table(data$congreso))[1]] = "C1995_2000"
data$congresoR[data$congreso == names(table(data$congreso))[2]] = "C2001_2006"
data$congresoR[data$congreso == names(table(data$congreso))[3]] = "C2006_2011"
data$congresoR[data$congreso == names(table(data$congreso))[4]] = "C2011_2016"
data$congresoR[data$congreso == names(table(data$congreso))[5]] = "C2011_2016"
data$congresoR[data$congreso == names(table(data$congreso))[6]] = "C2016_2021"
```

```{r include=FALSE}
#Proponente
data$proponenteR[data$proponente == names(table(data$proponente))[1]] = NA
data$proponenteR[data$proponente == names(table(data$proponente))[2]] = "BCR"
data$proponenteR[data$proponente == names(table(data$proponente))[3]] = "BCR"
data$proponenteR[data$proponente == names(table(data$proponente))[4]] = "Colegios Profesionales"
data$proponenteR[data$proponente == names(table(data$proponente))[5]] = "Colegios Profesionales"
data$proponenteR[data$proponente == names(table(data$proponente))[6]] = "CNM"
data$proponenteR[data$proponente == names(table(data$proponente))[7]] = "Gobiernos Regionales"
data$proponenteR[data$proponente == names(table(data$proponente))[8]] = "Contraloria"
data$proponenteR[data$proponente == names(table(data$proponente))[9]] = "Poder Judicial"
data$proponenteR[data$proponente == names(table(data$proponente))[10]] = "Colegios Profesionales"
data$proponenteR[data$proponente == names(table(data$proponente))[11]] = "Congreso"
data$proponenteR[data$proponente == names(table(data$proponente))[12]] = "CNM"
data$proponenteR[data$proponente == names(table(data$proponente))[13]] = "Contraloria"
data$proponenteR[data$proponente == names(table(data$proponente))[14]] = "Poder Judicial"
data$proponenteR[data$proponente == names(table(data$proponente))[15]] = "Defensoria"
data$proponenteR[data$proponente == names(table(data$proponente))[16]] = "Defensoria"
data$proponenteR[data$proponente == names(table(data$proponente))[17]] = "Fiscalia"
data$proponenteR[data$proponente == names(table(data$proponente))[18]] = "Gobiernos Locales"
data$proponenteR[data$proponente == names(table(data$proponente))[19]] = "Gobiernos Regionales"
data$proponenteR[data$proponente == names(table(data$proponente))[20]] = "Iniciativas Ciudadanas"
data$proponenteR[data$proponente == names(table(data$proponente))[21]] = "JNE"
data$proponenteR[data$proponente == names(table(data$proponente))[22]] = "JNE"
data$proponenteR[data$proponente == names(table(data$proponente))[23]] = "Gobiernos Locales"
data$proponenteR[data$proponente == names(table(data$proponente))[24]] = "Ministerio Publico"
data$proponenteR[data$proponente == names(table(data$proponente))[25]] = "Gobiernos Locales"
data$proponenteR[data$proponente == names(table(data$proponente))[26]] = "ONPE"
data$proponenteR[data$proponente == names(table(data$proponente))[27]] = "ONPE"
data$proponenteR[data$proponente == names(table(data$proponente))[28]] = "Poder Ejecutivo"
data$proponenteR[data$proponente == names(table(data$proponente))[29]] = "Poder Ejecutivo"
data$proponenteR[data$proponente == names(table(data$proponente))[30]] = "Poder Ejecutivo"
data$proponenteR[data$proponente == names(table(data$proponente))[31]] = "Poder Ejecutivo"
data$proponenteR[data$proponente == names(table(data$proponente))[32]] = "RENIEC"
data$proponenteR[data$proponente == names(table(data$proponente))[33]] = "RENIEC"
data$proponenteR[data$proponente == names(table(data$proponente))[34]] = "SBS"
data$proponenteR[data$proponente == names(table(data$proponente))[35]] = "TC"
data$proponenteR[data$proponente == names(table(data$proponente))[36]] = "TC"
```

```{r include=FALSE}
#Poder Ejecutivo
data$ProponeEjecutivo = factor(ifelse(data$proponenteR=="Poder Ejecutivo",1,0))
```

```{r include=FALSE}
#Grupo Parlamentario 
data$grupoParlamentarioR=data$grupoParlamentario

data$grupoParlamentarioR[data$grupoParlamentario == names(table(data$grupoParlamentario))[3]] = "Multipartidario"
data$grupoParlamentarioR[data$grupoParlamentario == names(table(data$grupoParlamentario))[9]] = "Multipartidario"
data$grupoParlamentarioR[data$grupoParlamentario == names(table(data$grupoParlamentario))[11]] = "Comision Especial"
data$grupoParlamentarioR[data$grupoParlamentario == names(table(data$grupoParlamentario))[25]] = "Partido Aprista Peruano"
data$grupoParlamentarioR[data$grupoParlamentario == names(table(data$grupoParlamentario))[26]] = "Multipartidario"
data$grupoParlamentarioR[data$grupoParlamentario == names(table(data$grupoParlamentario))[27]] = "Multipartidario"
data$grupoParlamentarioR[data$grupoParlamentario == names(table(data$grupoParlamentario))[29]] = "Multipartidario"
data$grupoParlamentarioR[data$grupoParlamentario == names(table(data$grupoParlamentario))[33]] = "Multipartidario"
```

```{r include=FALSE}
#Partido oficialista
data$GPOficialista=factor(ifelse(data$congresoR=="C1995_2000" & 
                                 data$grupoParlamentarioR == "Grupo Fujimorista",1,
                          ifelse(data$congresoR=="C2001_2006" &  
                                 data$grupoParlamentarioR == "Peru Posible",1,
                          ifelse(data$congresoR=="C2006_2011" &  
                                 data$grupoParlamentarioR == "Partido Aprista Peruano",1,
                          ifelse(data$congresoR=="C2011_2016" &  
                                 data$grupoParlamentarioR == "Grupo Parlamentario Nacionalista",1, 
                          ifelse(data$congresoR=="C2016_2021" &  
                                 data$grupoParlamentarioR == "Peruanos por el Kambio",1,0))))))
```

```{r include=FALSE}
#Estado promulgado
data$Promulgado= factor(ifelse(grepl("Publicado", data$estadoFinal),1,
                       ifelse(grepl("Promulgado", data$estadoFinal),1,0)))
```


```{r include=FALSE}
#Fecha presentaci??n:
data$fechaPresentacion = as.POSIXct(strptime(data$fechaPresentacion, format="%d/%m/%y"))
```

```{r include=FALSE}
#Fecha estado final:
data$FechaPromulgado = ifelse(data$congresoR=="C1995_2000" & 
                                 data$Promulgado == "0","26/07/00",
                          ifelse(data$congresoR =="C2001_2006" &  
                                 data$Promulgado == "0","26/07/06",
                          ifelse(data$congresoR =="C2006_2011" &  
                                 data$Promulgado == "0","26/07/11",
                          ifelse(data$congresoR =="C2011_2016" &  
                                 data$Promulgado == "0","26/07/16", 
                          ifelse(data$congresoR =="C2016_2021" &  
                                 data$Promulgado == "0","12/11/18", data$estadoFinalFecha)))))

data$FechaPromulgado=as.POSIXct(strptime(data$FechaPromulgado, format="%d/%m/%y"))
```

```{r include=FALSE}
#Tiempo publicacion
data$TiempoP=difftime(data$FechaPromulgado,data$fechaPresentacion, units = "weeks")
```

__Índice __

  * [Introducción](#Intro)
  * [Análisis periodo 1995-2000](#P1995)
  * [Análisis periodo 2001-2006](#P2001)
  * [Análisis periodo 2006-2011](#P2006)
  * [Análisis periodo 2011-2016](#P2011) 
  * [Análisis periodo 2016-2021](#P2016)
    
#### Introducción

<a id='Intro'></a> 

El siguiente ejercicio evalúa la promulgación de leyes de los últimos 5 periodos parlamentarios. En total, se analizaron **34 587 propuestas de ley.** El valor promedio de propuestas de ley emitidas es de **6 917 proyectos** en los 5 periodos. De todos ellos, el periodo parlamentario entre los años 2001 y 2006 muestra una marcada diferencia con respecto a los cuatro restantes, con **14 841 proyectos de ley**, dato que se encuentra por encima del valor promedio.

```{r include=FALSE}
leyesCongreso = data %>% group_by(congresoR) %>%  summarise(leyes=n()) 
```

```{r fig.height = 3.5, echo=FALSE,warning=FALSE}
ggplot(data=leyesCongreso, aes(x=congresoR, y=leyes)) +
  geom_bar(stat="identity", fill="darkgrey") + labs(title="Propuestas de ley por legislatura", y="Numero total", x="Legislatura", caption="Promedio de propuestas de ley por legislatura: 6 917") +
    	    theme(panel.background=element_rect(fill = "white", colour = "black")) + theme(plot.title = element_text(hjust = 0.5)) + geom_hline(yintercept = mean(leyesCongreso$leyes) ,linetype="dashed", color="red")  + geom_text(aes(label=leyes), vjust=1.6, color="white", size=3) 
```

###  Análisis periodo 1995-2000

<a id='P1995'></a> 

En la siguiente sección, se analizan las **5 807 leyes propuestas** durante el periodo legislativo 1995-2000. 

#### Proponentes

La siguiente tabla muestra el número de leyes propuestas y el número de leyes promulgadas por tipo de proponente. En total, son **14 tipos de proponentes distintos**, de los cuales el Congreso, el Poder Ejecutivo y los Gobiernos Locales son los que denotan un mayor un número de propuestas de ley, así como de leyes promulgadas. Sin embargo, de ese conjunto, el Congreso muestra una marcada diferencia. Entre los años 1995 y 2000, este último emitió **5 231** propuestas de ley, de las cuales **1 133** fueron emitidas.

```{r echo=FALSE, message=FALSE, warning=FALSE}
proponentes1 = data %>% filter(congresoR=="C1995_2000") %>% group_by(proponenteR)  %>% summarise(N_Leyes=n())

proponentes2 = data %>% filter(congresoR=="C1995_2000" & Promulgado=="1") %>% group_by(proponenteR)  %>% summarise(N_Leyes_Promulgadas=n())

proponentes= left_join(proponentes1, proponentes2)
proponentes$N_Leyes_Promulgadas[is.na(proponentes$N_Leyes_Promulgadas)]=0
proponentes=proponentes[order(-proponentes$N_Leyes),]
proponentes=proponentes[complete.cases(proponentes),]

datatable(proponentes, options=list(pageLength=5, scrollX="500px"))
```

El siguiente gráfico muestra el estado de las leyes propuestas por tipo de proponente. De los 14 proponentes, los unicos cuyas propuestas de ley llegan a ser promulgadas en una proporción equivalente al 50% del total o más, son la Defensoría del Pueblo, el Poder Ejecutivo, el Consejo Nacional de la Magistratura y el Tribunal Constitucional. Sin embargo, como se observó en la tabla anterior, entre el año 1995 y el año 2000, la cantidad de propuestas de ley emitidas por muchos de ellos es bastante escasa.

```{r include=FALSE}
proponentes = proponentes  %>% 
         mutate(N_Leyes_NoPromulgadas = N_Leyes - N_Leyes_Promulgadas,
                Promulgadas = (N_Leyes_Promulgadas/N_Leyes)*100,
                NoPromulgadas = (N_Leyes_NoPromulgadas/N_Leyes)*100)

proponentes$orden=c(1:14)

proponentes = gather(proponentes, Estado, value=Porcentaje, Promulgadas, NoPromulgadas)

proponentes$Porcentaje[proponentes$Porcentaje==0] = NA
```

```{r fig.height = 4, echo=FALSE, fig.width=8.5, warning=FALSE}
ggplot(proponentes, aes(x = reorder(proponenteR,-orden), y = Porcentaje, fill = Estado)) + 
  geom_bar(stat = "identity") + coord_flip() +
  geom_text(aes(label=paste0(round(Porcentaje,1), "%")), position=position_stack(vjust=0.5), vjust = .5, size = 3, col="white") + labs(title="Estado de leyes propuestas por proponente (1995-2000)", y="Porcentaje (%)", x="Tipo de proponente") + theme(plot.title = element_text(hjust = 0.5)) +
    	    theme(panel.background=element_rect(fill = "white", colour = "black"))
```

El siguiente gráfico muestra el tiempo promedio para que una ley sea promulgada, en función del tipo de proponente. En este análisis, se tomaron en cuenta únicamente las leyes promulgadas. Así, el tiempo promedio para la promulgación de una ley, entre el años 1995 y el año 2000, es de, aproximadamente, 23 semanas. Del total de proponentes, son 7 los que muestran valores menores para la promulgación de leyes en comparación al valor promedio. Estos son: el Tribunal Constitucional, el Poder Judicial, el Poder Ejecutivo, la Oficina Nacional de Procesos Electorales, la Fiscalía de la Nación y el Consejo Nacional de la Magistratura.

```{r include=FALSE}
#Promedios: 
meanTiempo = data %>% filter(congresoR=="C1995_2000" & Promulgado=="1") %>% 
  group_by(proponenteR) %>% 
  summarise(Leyes = n(),
            Tiempo = mean(as.numeric(TiempoP)), 
            seTiempo = seMean(as.numeric(TiempoP)))
meanTiempo=meanTiempo[order(-meanTiempo$Leyes),]
```


```{r fig.height = 4, echo=FALSE,warning=FALSE}
ggplot(meanTiempo, aes(x=proponenteR, y=Tiempo)) + 
    geom_errorbar(aes(ymin=Tiempo-seTiempo, ymax=Tiempo+seTiempo), width=.1) +
    geom_point()+ labs(title="Tiempo promedio para promulgar una ley por proponente (1995-2000)", y="Tiempo promedio (semanas)", x="Proponente", caption="Tiempo promedio: 23.4 semanas") + theme(plot.title = element_text(hjust = 0.5)) + theme(panel.background=element_rect(fill = "white", colour = "black")) + theme(axis.text.x = element_text(angle = 90, hjust = 1))+ geom_hline(yintercept = mean(meanTiempo$Tiempo) ,linetype="dashed", color="red")

```

#### Grupos parlamentarios 

```{r echo=FALSE, message=FALSE, warning=FALSE}
proponentes1 = data %>% filter(congresoR=="C1995_2000") %>% group_by(grupoParlamentarioR)  %>% summarise(N_Leyes=n())

proponentes2 = data %>% filter(congresoR=="C1995_2000" & Promulgado=="1") %>% group_by(grupoParlamentarioR)  %>% summarise(N_Leyes_Promulgadas=n())

proponentes= left_join(proponentes1, proponentes2)
proponentes$N_Leyes_Promulgadas[is.na(proponentes$N_Leyes_Promulgadas)]=0
proponentes=proponentes[order(-proponentes$N_Leyes),]
proponentes=proponentes[complete.cases(proponentes),]

datatable(proponentes, options=list(pageLength=5, scrollX="500px"))
```

El siguiente gráfico muestra el estado de las leyes propuestas por grupo parlamentario. En este ejercicio, hubo una gran cantidad de leyes propuestas que no contaban con ningún grupo parlamentario. De aquellas que sí mostraron la presencia de alguno, fue el Grupo Fujimorista el que registró la mayor cantidad de leyes propuestas, de las cuales el 92.1% fueron promulgadas entre el año 1995 y el año 2000.

```{r include=FALSE}
proponentes = proponentes  %>% 
         mutate(N_Leyes_NoPromulgadas = N_Leyes - N_Leyes_Promulgadas,
                Promulgadas = (N_Leyes_Promulgadas/N_Leyes)*100,
                NoPromulgadas = (N_Leyes_NoPromulgadas/N_Leyes)*100)

proponentes$orden=c(1:6)

proponentes = gather(proponentes, Estado, value=Porcentaje, Promulgadas, NoPromulgadas)

proponentes$Porcentaje[proponentes$Porcentaje==0] = NA
```

```{r fig.height = 4, echo=FALSE, fig.width=8.5, warning=FALSE}
ggplot(proponentes, aes(x = reorder(grupoParlamentarioR,-orden), y = Porcentaje, fill = Estado)) + 
  geom_bar(stat = "identity") + coord_flip() +
  geom_text(aes(label=paste0(round(Porcentaje,1), "%")), position=position_stack(vjust=0.5), vjust = .5, size = 3, col="white") + labs(title="Estado de leyes propuestas por grupo parlamentario (1995-2000)", y="Porcentaje (%)", x="Tipo de proponente") + theme(plot.title = element_text(hjust = 0.5)) +
    	    theme(panel.background=element_rect(fill = "white", colour = "black"))
```

El siguiente gráfico muestra el tiempo promedio para que una ley sea promulgada por grupo parlamentario. Al igual que en el ejercicio anterior, se consideraron únicamente a las leyes promulgadas en el análisis. Del total de grupos parlamentarios, los úncios cuyas leyes propuestas fueron aprobadas en un tiempo menor al valor promedio de promulación de leyes fueron el Grupo Fujimoristas y los congresistas no agrupados.

```{r include=FALSE}
#Promedios: 
meanTiempo = data %>% filter(congresoR=="C1995_2000" & Promulgado=="1") %>% 
  group_by(grupoParlamentarioR) %>% 
  summarise(Leyes = n(),
            Tiempo = mean(as.numeric(TiempoP)), 
            seTiempo = seMean(as.numeric(TiempoP)))
meanTiempo=meanTiempo[order(-meanTiempo$Leyes),]
```

```{r fig.height = 4, echo=FALSE,warning=FALSE}
ggplot(meanTiempo, aes(x=grupoParlamentarioR, y=Tiempo)) + 
    geom_errorbar(aes(ymin=Tiempo-seTiempo, ymax=Tiempo+seTiempo), width=.1) +
    geom_point()+ labs(title="Tiempo promedio para promulgar una ley por Grupo Parlamentario (1995-2000)", y="Tiempo promedio (semanas)", x="Grupo Parlamentario", caption="Tiempo promedio: 23.4 semanas") + theme(plot.title = element_text(hjust = 0.5)) + theme(panel.background=element_rect(fill = "white", colour = "black")) + theme(axis.text.x = element_text(angle = 90, hjust = 1))+ geom_hline(yintercept = mean(meanTiempo$Tiempo) ,linetype="dashed", color="red")

```

#### Análisis del contenido de Leyes Propuestas

Este análisis tuvo la finalidad de conocer los temas priorizados en las leyes propuestas y promulgadas entre el año 1995 y el año 2000. Para ello, se realizó un contéo de las palabras que fueron mencionadas con mayor frecuencia en los documentos en cuestión. Para la realización de este ejercicio, fueron eliminadas las palabras que proveen de poca o nula información sobre los temas abordados por las leyes propuestas y promulgadas. Los resultados del análisis arrojan que las palabras mencionadas con mayor frecuencia en las leyes no promulgadas fueron "impuesto","constitución" y "penal". Por su parte, las palabras que aparecen con mayor frecuencia en las leyes promulgadas fueron "impuesto", "ventas" y ministerio.

```{r include=FALSE}
dataText = data %>% filter(congresoR=="C1995_2000" & Promulgado=="1") %>% select(sumilla)
modi<-Corpus(VectorSource(dataText$sumilla))
```

```{r include=FALSE}
modi_data<-tm_map(modi,stripWhitespace)
modi_data<-tm_map(modi_data,tolower)
modi_data<-tm_map(modi_data,removeNumbers)
modi_data<-tm_map(modi_data,removePunctuation)
modi_data<-tm_map(modi_data,removeWords, stopwords("spanish"))
```

```{r include=FALSE}
modi_data<-tm_map(modi_data, removeWords, c("ley", "articulo", "decreto", "legislativo", "modificado", "modifica", "proyecto", "general", "modificando", "codigo", "articulos", "estableciendo", "republica", "referente", "inciso", "peru", "comision", "establece", "organica", "fin", "anos", "plazo", "ano", "declarando", "plazo", "diciembre", "presente", "parrafo", "texto", "creando", "derogando", "cada", "dos", "seran", "mas", "cargo", "refiere", "declara", "autoriza", "partir", "referido", "forma", "deroga", "actos", "dia", "supremo", "final", "san", "dicha", "caso", "nacional", "ser", "asi", "mismo", "titulo", "toda", "todo", "prorroga", "publico", "publica", "acuerdo", "poder", "vigencia", "dias", "disposicion"))
```

```{r include=FALSE}
dtm <- TermDocumentMatrix(modi_data)
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v)
d=d[c(1:20),]
d=d[order(-d$freq),]
d$orden=c(1:20)
```

```{r include=FALSE}
dataText = data %>% filter(congresoR=="C1995_2000" & Promulgado=="0") %>% select(sumilla)
modi<-Corpus(VectorSource(dataText$sumilla))
```

```{r include=FALSE}
modi_data<-tm_map(modi,stripWhitespace)
modi_data<-tm_map(modi_data,tolower)
modi_data<-tm_map(modi_data,removeNumbers)
modi_data<-tm_map(modi_data,removePunctuation)
modi_data<-tm_map(modi_data,removeWords, stopwords("spanish"))
```

```{r include=FALSE}
modi_data<-tm_map(modi_data, removeWords, c("ley", "articulo", "decreto", "legislativo", "modificado", "modifica", "proyecto", "general", "modificando", "codigo", "articulos", "estableciendo", "republica", "referente", "inciso", "peru", "comision", "establece", "organica", "fin", "anos", "plazo", "ano", "declarando", "plazo", "diciembre", "presente", "parrafo", "texto", "creando", "derogando", "cada", "dos", "seran", "mas", "cargo", "refiere", "declara", "autoriza", "partir", "referido", "forma", "deroga", "actos", "dia", "supremo", "final", "san", "dicha", "caso", "nacional", "ser", "asi", "mismo", "titulo", "toda", "todo", "prorroga", "publico", "publica", "acuerdo", "poder", "vigencia", "dias", "disposicion"))
```

```{r include=FALSE}
dtm <- TermDocumentMatrix(modi_data)
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
d2 <- data.frame(word = names(v),freq=v)
d2=d2[c(1:20),]
d2=d2[order(-d2$freq),]
d2$orden=c(1:20)
```

```{r fig.height = 4.5, echo=FALSE,warning=FALSE}
m1= ggplot(d, aes(x = reorder(word,-orden), y = freq)) +
  geom_bar(stat="identity", fill="darkgrey") + labs(title="Leyes Promulgadas", y="Numero de menciones", x="") +
    	    theme(panel.background=element_rect(fill = "white", colour = "black")) + coord_flip()

m2= ggplot(d2, aes(x = reorder(word,-orden), y = freq)) +
  geom_bar(stat="identity", fill="darkgrey") + labs(title="Leyes No Promulgadas", y="Numero de menciones", x="") +
    	    theme(panel.background=element_rect(fill = "white", colour = "black")) + coord_flip() + scale_y_continuous(breaks = seq(0, 250, by = 50))

ggarrange(m1,m2, ncol = 2, nrow = 1)
```

#### Determinantes de la promulgación de leyes 

Regresión survival (Periodo 1995 - 2000):

```{r}
ModeloCongreso=data[data$congresoR=='C1995_2000',]
```

```{r}
ModeloCongreso = ModeloCongreso[,c(19,21,22,24)]
```

```{r}
library(survival)
ModeloCongreso$survival=with(ModeloCongreso,Surv(TiempoP, as.numeric(Promulgado)))
```

```{r}
modelo1 <- coxph(survival ~ GPOficialista + ProponeEjecutivo,data=ModeloCongreso)
summary(modelo1)

```

Impacto del grupo oficialista en la probabilidad de publicación del proyecto de ley:
```{r}
library(ggplot2)
library(ggfortify)
KM.fondos = survfit(survival ~ GPOficialista, data = ModeloCongreso)

###
ejeX='TIEMPO HASTA QUE SE PUBLICA EL PROYECTO\n curva cae cuando el proyecto es publicado'
ejeY='Probabilidad de que el proyecto sea publicado'
titulo="Curva de Sobrevivencia (1995 - 2000)"
autoplot(KM.fondos,
         xlab=ejeX,
         ylab=ejeY, 
         main = titulo,
         conf.int = F)
```

Impacto del Poder Ejecutivo como proponente en la probabilidad de publicación del proyecto de ley:

```{r}
library(ggplot2)
library(ggfortify)
KM.fondos = survfit(survival ~ ProponeEjecutivo, data = ModeloCongreso)

###
ejeX='TIEMPO HASTA QUE SE PUBLICA EL PROYECTO\n curva cae cuando el proyecto es publicado'
ejeY='Probabilidad de que el proyecto sea publicado'
titulo="Curva de Sobrevivencia (1995 - 2000)"
autoplot(KM.fondos,
         xlab=ejeX,
         ylab=ejeY, 
         main = titulo,
         conf.int = F)
```

<a id='P2001'></a> 

###  Análisis periodo 2001-2006

#### Proponentes

La siguiente tabla muestra el número de leyes propuestas por tipo de proponente y el número de leyes promulgadas por tipo de proponente. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
proponentes1 = data %>% filter(congresoR=="C2001_2006") %>% group_by(proponenteR)  %>% summarise(N_Leyes=n())

proponentes2 = data %>% filter(congresoR=="C2001_2006" & Promulgado=="1") %>% group_by(proponenteR)  %>% summarise(N_Leyes_Promulgadas=n())

proponentes= left_join(proponentes1, proponentes2)
proponentes$N_Leyes_Promulgadas[is.na(proponentes$N_Leyes_Promulgadas)]=0
proponentes=proponentes[order(-proponentes$N_Leyes),]
proponentes=proponentes[complete.cases(proponentes),]

datatable(proponentes, options=list(pageLength=5, scrollX="500px"))
```

El siguiente gráfico muestra el estado de las leyes propuestas por tipo de proponente. 

```{r include=FALSE}
proponentes = proponentes  %>% 
         mutate(N_Leyes_NoPromulgadas = N_Leyes - N_Leyes_Promulgadas,
                Promulgadas = (N_Leyes_Promulgadas/N_Leyes)*100,
                NoPromulgadas = (N_Leyes_NoPromulgadas/N_Leyes)*100)

proponentes$orden=c(1:15)

proponentes = gather(proponentes, Estado, value=Porcentaje, Promulgadas, NoPromulgadas)

proponentes$Porcentaje[proponentes$Porcentaje==0] = NA
```

```{r fig.height = 4, echo=FALSE, fig.width=8.5, warning=FALSE}
ggplot(proponentes, aes(x = reorder(proponenteR,-orden), y = Porcentaje, fill = Estado)) + 
  geom_bar(stat = "identity") + coord_flip() +
  geom_text(aes(label=paste0(round(Porcentaje,1), "%")), position=position_stack(vjust=0.5), vjust = .5, size = 3, col="white") + labs(title="Estado de leyes propuestas por proponente (2001-2006)", y="Porcentaje (%)", x="Tipo de proponente") + theme(plot.title = element_text(hjust = 0.5)) +
    	    theme(panel.background=element_rect(fill = "white", colour = "black"))
```

El siguiente gráfico muestra el tiempo promedio para que una ley sea promulgada por tipo de proponente [Se consideran únicamente a las leyes promulgadas para el análisis].

```{r include=FALSE}
#Promedios: 
meanTiempo = data %>% filter(congresoR=="C2001_2006" & Promulgado=="1") %>% 
  group_by(proponenteR) %>% 
  summarise(Leyes = n(),
            Tiempo = mean(as.numeric(TiempoP)), 
            seTiempo = seMean(as.numeric(TiempoP)))
meanTiempo=meanTiempo[order(-meanTiempo$Leyes),]
```


```{r fig.height = 4, echo=FALSE,warning=FALSE}
ggplot(meanTiempo, aes(x=proponenteR, y=Tiempo)) + 
    geom_errorbar(aes(ymin=Tiempo-seTiempo, ymax=Tiempo+seTiempo), width=.1) +
    geom_point()+ labs(title="Tiempo promedio para promulgar una ley por proponente (2001-2006)", y="Tiempo promedio (semanas)", x="Proponente", caption="Tiempo promedio: 45 semanas") + theme(plot.title = element_text(hjust = 0.5)) + theme(panel.background=element_rect(fill = "white", colour = "black")) + theme(axis.text.x = element_text(angle = 90, hjust = 1))+ geom_hline(yintercept = mean(meanTiempo$Tiempo) ,linetype="dashed", color="red")

```

#### Grupos parlamentarios 

```{r echo=FALSE, message=FALSE, warning=FALSE}
proponentes1 = data %>% filter(congresoR=="C2001_2006") %>% group_by(grupoParlamentarioR)  %>% summarise(N_Leyes=n())

proponentes2 = data %>% filter(congresoR=="C2001_2006" & Promulgado=="1") %>% group_by(grupoParlamentarioR)  %>% summarise(N_Leyes_Promulgadas=n())

proponentes= left_join(proponentes1, proponentes2)
proponentes$N_Leyes_Promulgadas[is.na(proponentes$N_Leyes_Promulgadas)]=0
proponentes=proponentes[order(-proponentes$N_Leyes),]
proponentes=proponentes[complete.cases(proponentes),]

datatable(proponentes, options=list(pageLength=5, scrollX="500px"))
```

El siguiente gráfico muestra el estado de las leyes propuestas por grupo parlamentario.

```{r include=FALSE}
proponentes = proponentes  %>% 
         mutate(N_Leyes_NoPromulgadas = N_Leyes - N_Leyes_Promulgadas,
                Promulgadas = (N_Leyes_Promulgadas/N_Leyes)*100,
                NoPromulgadas = (N_Leyes_NoPromulgadas/N_Leyes)*100)

proponentes$orden=c(1:6)

proponentes = gather(proponentes, Estado, value=Porcentaje, Promulgadas, NoPromulgadas)

proponentes$Porcentaje[proponentes$Porcentaje==0] = NA
```

```{r fig.height = 4, echo=FALSE, fig.width=8.5, warning=FALSE}
ggplot(proponentes, aes(x = reorder(grupoParlamentarioR,-orden), y = Porcentaje, fill = Estado)) + 
  geom_bar(stat = "identity") + coord_flip() +
  geom_text(aes(label=paste0(round(Porcentaje,1), "%")), position=position_stack(vjust=0.5), vjust = .5, size = 3, col="white") + labs(title="Estado de leyes propuestas por grupo parlamentario (2001-2006)", y="Porcentaje (%)", x="Tipo de proponente") + theme(plot.title = element_text(hjust = 0.5)) +
    	    theme(panel.background=element_rect(fill = "white", colour = "black"))
```

El siguiente gráfico muestra el tiempo promedio para que una ley sea promulgada por grupo parlamentario [Se consideran únicamente a las leyes promulgadas para el análisis].

```{r include=FALSE}
#Promedios: 
meanTiempo = data %>% filter(congresoR=="C2001_2006" & Promulgado=="1") %>% 
  group_by(grupoParlamentarioR) %>% 
  summarise(Leyes = n(),
            Tiempo = mean(as.numeric(TiempoP)), 
            seTiempo = seMean(as.numeric(TiempoP)))
meanTiempo=meanTiempo[order(-meanTiempo$Leyes),]
```

```{r fig.height = 6, echo=FALSE,warning=FALSE}
ggplot(meanTiempo, aes(x=grupoParlamentarioR, y=Tiempo)) + 
    geom_errorbar(aes(ymin=Tiempo-seTiempo, ymax=Tiempo+seTiempo), width=.1) +
    geom_point()+ labs(title="Tiempo promedio para promulgar una ley por Grupo Parlamentario (2001-2006)", y="Tiempo promedio (semanas)", x="Grupo Parlamentario", caption="Tiempo promedio: 46 semanas") + theme(plot.title = element_text(hjust = 0.5)) + theme(panel.background=element_rect(fill = "white", colour = "black")) + theme(axis.text.x = element_text(angle = 90, hjust = 1))+ geom_hline(yintercept = mean(meanTiempo$Tiempo) ,linetype="dashed", color="red")

```

#### Análisis del contenido de Leyes Propuestas

```{r include=FALSE}
dataText = data %>% filter(congresoR=="C2001_2006" & Promulgado=="1") %>% select(sumilla)
modi<-Corpus(VectorSource(dataText$sumilla))
```

```{r include=FALSE}
modi_data<-tm_map(modi,stripWhitespace)
modi_data<-tm_map(modi_data,tolower)
modi_data<-tm_map(modi_data,removeNumbers)
modi_data<-tm_map(modi_data,removePunctuation)
modi_data<-tm_map(modi_data,removeWords, stopwords("spanish"))
```

```{r include=FALSE}
modi_data<-tm_map(modi_data, removeWords, c("ley", "articulo", "decreto", "legislativo", "modificado", "modifica", "proyecto", "general", "modificando", "codigo", "articulos", "estableciendo", "republica", "referente", "inciso", "peru", "comision", "establece", "organica", "fin", "anos", "plazo", "ano", "declarando", "plazo", "diciembre", "presente", "parrafo", "texto", "creando", "derogando", "cada", "dos", "seran", "mas", "cargo", "refiere", "declara", "autoriza", "partir", "referido", "forma", "deroga", "actos", "dia", "supremo", "final", "san", "dicha", "caso", "nacional", "ser", "asi", "mismo", "titulo", "toda", "todo", "prorroga", "publico", "publica", "acuerdo", "poder", "vigencia", "dias", "disposicion", "propone", "modificar", "num", "propuesta", "incorporar", "declarar", "establecer"))
```

```{r include=FALSE}
dtm <- TermDocumentMatrix(modi_data)
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v)
d=d[c(1:20),]
d=d[order(-d$freq),]
d$orden=c(1:20)
```

```{r include=FALSE}
dataText = data %>% filter(congresoR=="C2001_2006" & Promulgado=="0") %>% select(sumilla)
modi<-Corpus(VectorSource(dataText$sumilla))
```

```{r include=FALSE}
modi_data<-tm_map(modi,stripWhitespace)
modi_data<-tm_map(modi_data,tolower)
modi_data<-tm_map(modi_data,removeNumbers)
modi_data<-tm_map(modi_data,removePunctuation)
modi_data<-tm_map(modi_data,removeWords, stopwords("spanish"))
```

```{r include=FALSE}
modi_data<-tm_map(modi_data, removeWords, c("ley", "articulo", "decreto", "legislativo", "modificado", "modifica", "proyecto", "general", "modificando", "codigo", "articulos", "estableciendo", "republica", "referente", "inciso", "peru", "comision", "establece", "organica", "fin", "anos", "plazo", "ano", "declarando", "plazo", "diciembre", "presente", "parrafo", "texto", "creando", "derogando", "cada", "dos", "seran", "mas", "cargo", "refiere", "declara", "autoriza", "partir", "referido", "forma", "deroga", "actos", "dia", "supremo", "final", "san", "dicha", "caso", "nacional", "ser", "asi", "mismo", "titulo", "toda", "todo", "prorroga", "publico", "publica", "acuerdo", "poder", "vigencia", "dias", "disposicion", "propone", "modificar", "num", "propuesta", "incorporar", "declarar", "establecer"))
```

```{r include=FALSE}
dtm <- TermDocumentMatrix(modi_data)
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
d2 <- data.frame(word = names(v),freq=v)
d2=d2[c(1:20),]
d2=d2[order(-d2$freq),]
d2$orden=c(1:20)
```

```{r fig.height = 4.5, echo=FALSE,warning=FALSE}
m1= ggplot(d, aes(x = reorder(word,-orden), y = freq)) +
  geom_bar(stat="identity", fill="darkgrey") + labs(title="Leyes Promulgadas", y="Numero de menciones", x="") +
    	    theme(panel.background=element_rect(fill = "white", colour = "black")) + coord_flip()

m2= ggplot(d2, aes(x = reorder(word,-orden), y = freq)) +
  geom_bar(stat="identity", fill="darkgrey") + labs(title="Leyes No Promulgadas", y="Numero de menciones", x="") +
    	    theme(panel.background=element_rect(fill = "white", colour = "black")) + coord_flip() + scale_y_continuous(breaks = seq(0, 250, by = 50))

ggarrange(m1,m2, ncol = 2, nrow = 1)
```

#### Determinantes de la promulgación de leyes 

Regresión survival (Periodo 2001 - 2006):

```{r}
ModeloCongreso=data[data$congresoR=='C2001_2006',]
```

```{r}
ModeloCongreso = ModeloCongreso[,c(19,21,22,24)]
```

```{r}
library(survival)
ModeloCongreso$survival=with(ModeloCongreso,Surv(TiempoP, as.numeric(Promulgado)))
```

```{r}
modelo1 <- coxph(survival ~ GPOficialista + ProponeEjecutivo,data=ModeloCongreso)
summary(modelo1)

```

```{r}
library(ggplot2)
library(ggfortify)
KM.fondos = survfit(survival ~ GPOficialista, data = ModeloCongreso)

###
ejeX='TIEMPO HASTA QUE SE PUBLICA EL PROYECTO\n curva cae cuando el proyecto es publicado'
ejeY='Probabilidad de que el proyecto sea publicado'
titulo="Curva de Sobrevivencia (2001 - 2006)"
autoplot(KM.fondos,
         xlab=ejeX,
         ylab=ejeY, 
         main = titulo,
         conf.int = F)
```

```{r}
library(ggplot2)
library(ggfortify)
KM.fondos = survfit(survival ~ ProponeEjecutivo, data = ModeloCongreso)

###
ejeX='TIEMPO HASTA QUE SE PUBLICA EL PROYECTO\n curva cae cuando el proyecto es publicado'
ejeY='Probabilidad de que el proyecto sea publicado'
titulo="Curva de Sobrevivencia (2001 - 2006)"
autoplot(KM.fondos,
         xlab=ejeX,
         ylab=ejeY, 
         main = titulo,
         conf.int = F)
```


<a id='P2006'></a> 

###  Análisis periodo 2006-2011

#### Proponentes

La siguiente tabla muestra el número de leyes propuestas por tipo de proponente y el número de leyes promulgadas por tipo de proponente. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
proponentes1 = data %>% filter(congresoR=="C2006_2011") %>% group_by(proponenteR)  %>% summarise(N_Leyes=n())

proponentes2 = data %>% filter(congresoR=="C2006_2011" & Promulgado=="1") %>% group_by(proponenteR)  %>% summarise(N_Leyes_Promulgadas=n())

proponentes= left_join(proponentes1, proponentes2)
proponentes$N_Leyes_Promulgadas[is.na(proponentes$N_Leyes_Promulgadas)]=0
proponentes=proponentes[order(-proponentes$N_Leyes),]
proponentes=proponentes[complete.cases(proponentes),]

datatable(proponentes, options=list(pageLength=5, scrollX="500px"))
```

El siguiente gráfico muestra el estado de las leyes propuestas por tipo de proponente. 

```{r include=FALSE}
proponentes = proponentes  %>% 
         mutate(N_Leyes_NoPromulgadas = N_Leyes - N_Leyes_Promulgadas,
                Promulgadas = (N_Leyes_Promulgadas/N_Leyes)*100,
                NoPromulgadas = (N_Leyes_NoPromulgadas/N_Leyes)*100)

proponentes$orden=c(1:16)

proponentes = gather(proponentes, Estado, value=Porcentaje, Promulgadas, NoPromulgadas)

proponentes$Porcentaje[proponentes$Porcentaje==0] = NA
```

```{r fig.height = 4, echo=FALSE, fig.width=8.5, warning=FALSE}
ggplot(proponentes, aes(x = reorder(proponenteR,-orden), y = Porcentaje, fill = Estado)) + 
  geom_bar(stat = "identity") + coord_flip() +
  geom_text(aes(label=paste0(round(Porcentaje,1), "%")), position=position_stack(vjust=0.5), vjust = .5, size = 3, col="white") + labs(title="Estado de leyes propuestas por proponente (2006-2011)", y="Porcentaje (%)", x="Tipo de proponente") + theme(plot.title = element_text(hjust = 0.5)) +
    	    theme(panel.background=element_rect(fill = "white", colour = "black"))
```

El siguiente gráfico muestra el tiempo promedio para que una ley sea promulgada por tipo de proponente [Se consideran únicamente a las leyes promulgadas para el an??lisis].

```{r include=FALSE}
#Promedios: 
meanTiempo = data %>% filter(congresoR=="C2006_2011" & Promulgado=="1") %>% 
  group_by(proponenteR) %>% 
  summarise(Leyes = n(),
            Tiempo = mean(as.numeric(TiempoP)), 
            seTiempo = seMean(as.numeric(TiempoP)))
meanTiempo=meanTiempo[order(-meanTiempo$Leyes),]
```


```{r fig.height = 4, echo=FALSE,warning=FALSE}
ggplot(meanTiempo, aes(x=proponenteR, y=Tiempo)) + 
    geom_errorbar(aes(ymin=Tiempo-seTiempo, ymax=Tiempo+seTiempo), width=.1) +
    geom_point()+ labs(title="Tiempo promedio para promulgar una ley por proponente (2006-2011)", y="Tiempo promedio (semanas)", x="Proponente", caption="Tiempo promedio: 55.8 semanas") + theme(plot.title = element_text(hjust = 0.5)) + theme(panel.background=element_rect(fill = "white", colour = "black")) + theme(axis.text.x = element_text(angle = 90, hjust = 1))+ geom_hline(yintercept = mean(meanTiempo$Tiempo) ,linetype="dashed", color="red")

```

#### Grupos parlamentarios 

```{r echo=FALSE, message=FALSE, warning=FALSE}
proponentes1 = data %>% filter(congresoR=="C2006_2011") %>% group_by(grupoParlamentarioR)  %>% summarise(N_Leyes=n())

proponentes2 = data %>% filter(congresoR=="C2006_2011" & Promulgado=="1") %>% group_by(grupoParlamentarioR)  %>% summarise(N_Leyes_Promulgadas=n())

proponentes= left_join(proponentes1, proponentes2)
proponentes$N_Leyes_Promulgadas[is.na(proponentes$N_Leyes_Promulgadas)]=0
proponentes=proponentes[order(-proponentes$N_Leyes),]
proponentes=proponentes[complete.cases(proponentes),]

datatable(proponentes, options=list(pageLength=5, scrollX="500px"))
```

El siguiente gráfico muestra el estado de las leyes propuestas por grupo parlamentario.

```{r include=FALSE}
proponentes = proponentes  %>% 
         mutate(N_Leyes_NoPromulgadas = N_Leyes - N_Leyes_Promulgadas,
                Promulgadas = (N_Leyes_Promulgadas/N_Leyes)*100,
                NoPromulgadas = (N_Leyes_NoPromulgadas/N_Leyes)*100)

proponentes$orden=c(1:15)

proponentes = gather(proponentes, Estado, value=Porcentaje, Promulgadas, NoPromulgadas)

proponentes$Porcentaje[proponentes$Porcentaje==0] = NA
```

```{r fig.height = 4, echo=FALSE, fig.width=8.5, warning=FALSE}
ggplot(proponentes, aes(x = reorder(grupoParlamentarioR,-orden), y = Porcentaje, fill = Estado)) + 
  geom_bar(stat = "identity") + coord_flip() +
  geom_text(aes(label=paste0(round(Porcentaje,1), "%")), position=position_stack(vjust=0.5), vjust = .5, size = 3, col="white") + labs(title="Estado de leyes propuestas por grupo parlamentario (2006-2011)", y="Porcentaje (%)", x="Tipo de proponente") + theme(plot.title = element_text(hjust = 0.5)) +
    	    theme(panel.background=element_rect(fill = "white", colour = "black"))
```

El siguiente gráfico muestra el tiempo promedio para que una ley sea promulgada por grupo parlamentario [Se consideran únicamente a las leyes promulgadas para el an??lisis].

```{r include=FALSE}
#Promedios: 
meanTiempo = data %>% filter(congresoR=="C2006_2011" & Promulgado=="1") %>% 
  group_by(grupoParlamentarioR) %>% 
  summarise(Leyes = n(),
            Tiempo = mean(as.numeric(TiempoP)), 
            seTiempo = seMean(as.numeric(TiempoP)))
meanTiempo=meanTiempo[order(-meanTiempo$Leyes),]
```

```{r fig.height = 6, echo=FALSE,warning=FALSE}
ggplot(meanTiempo, aes(x=grupoParlamentarioR, y=Tiempo)) + 
    geom_errorbar(aes(ymin=Tiempo-seTiempo, ymax=Tiempo+seTiempo), width=.1) +
    geom_point()+ labs(title="Tiempo promedio para promulgar una ley por Grupo Parlamentario (2006-2011)", y="Tiempo promedio (semanas)", x="Grupo Parlamentario", caption="Tiempo promedio: 50.4 semanas") + theme(plot.title = element_text(hjust = 0.5)) + theme(panel.background=element_rect(fill = "white", colour = "black")) + theme(axis.text.x = element_text(angle = 90, hjust = 1))+ geom_hline(yintercept = mean(meanTiempo$Tiempo) ,linetype="dashed", color="red")

```

#### An??lisis del contenido de Leyes Propuestas

```{r include=FALSE}
dataText = data %>% filter(congresoR=="C2006_2011" & Promulgado=="1") %>% select(sumilla)
modi<-Corpus(VectorSource(dataText$sumilla))
```

```{r include=FALSE}
modi_data<-tm_map(modi,stripWhitespace)
modi_data<-tm_map(modi_data,tolower)
modi_data<-tm_map(modi_data,removeNumbers)
modi_data<-tm_map(modi_data,removePunctuation)
modi_data<-tm_map(modi_data,removeWords, stopwords("spanish"))
```

```{r include=FALSE}
modi_data<-tm_map(modi_data, removeWords, c("ley", "articulo", "decreto", "legislativo", "modificado", "modifica", "proyecto", "general", "modificando", "codigo", "articulos", "estableciendo", "republica", "referente", "inciso", "peru", "comision", "establece", "organica", "fin", "anos", "plazo", "ano", "declarando", "plazo", "diciembre", "presente", "parrafo", "texto", "creando", "derogando", "cada", "dos", "seran", "mas", "cargo", "refiere", "declara", "autoriza", "partir", "referido", "forma", "deroga", "actos", "dia", "supremo", "final", "san", "dicha", "caso", "nacional", "ser", "asi", "mismo", "titulo", "toda", "todo", "prorroga", "publico", "publica", "acuerdo", "poder", "vigencia", "dias", "disposicion", "propone", "modificar", "num", "propuesta", "incorporar", "declarar", "establecer", "autorizar", "crear"))
```

```{r include=FALSE}
dtm <- TermDocumentMatrix(modi_data)
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v)
d=d[c(1:20),]
d=d[order(-d$freq),]
d$orden=c(1:20)
```

```{r include=FALSE}
dataText = data %>% filter(congresoR=="C2006_2011" & Promulgado=="0") %>% select(sumilla)
modi<-Corpus(VectorSource(dataText$sumilla))
```

```{r include=FALSE}
modi_data<-tm_map(modi,stripWhitespace)
modi_data<-tm_map(modi_data,tolower)
modi_data<-tm_map(modi_data,removeNumbers)
modi_data<-tm_map(modi_data,removePunctuation)
modi_data<-tm_map(modi_data,removeWords, stopwords("spanish"))
```

```{r include=FALSE}
modi_data<-tm_map(modi_data, removeWords, c("ley", "articulo", "decreto", "legislativo", "modificado", "modifica", "proyecto", "general", "modificando", "codigo", "articulos", "estableciendo", "republica", "referente", "inciso", "peru", "comision", "establece", "organica", "fin", "anos", "plazo", "ano", "declarando", "plazo", "diciembre", "presente", "parrafo", "texto", "creando", "derogando", "cada", "dos", "seran", "mas", "cargo", "refiere", "declara", "autoriza", "partir", "referido", "forma", "deroga", "actos", "dia", "supremo", "final", "san", "dicha", "caso", "nacional", "ser", "asi", "mismo", "titulo", "toda", "todo", "prorroga", "publico", "publica", "acuerdo", "poder", "vigencia", "dias", "disposicion", "propone", "modificar", "num", "propuesta", "incorporar", "declarar", "establecer", "autorizar", "crear"))
```

```{r include=FALSE}
dtm <- TermDocumentMatrix(modi_data)
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
d2 <- data.frame(word = names(v),freq=v)
d2=d2[c(1:20),]
d2=d2[order(-d2$freq),]
d2$orden=c(1:20)
```

```{r fig.height = 4.5, echo=FALSE,warning=FALSE}
m1= ggplot(d, aes(x = reorder(word,-orden), y = freq)) +
  geom_bar(stat="identity", fill="darkgrey") + labs(title="Leyes Promulgadas", y="Numero de menciones", x="") +
    	    theme(panel.background=element_rect(fill = "white", colour = "black")) + coord_flip()

m2= ggplot(d2, aes(x = reorder(word,-orden), y = freq)) +
  geom_bar(stat="identity", fill="darkgrey") + labs(title="Leyes No Promulgadas", y="Numero de menciones", x="") +
    	    theme(panel.background=element_rect(fill = "white", colour = "black")) + coord_flip() + scale_y_continuous(breaks = seq(0, 250, by = 50))

ggarrange(m1,m2, ncol = 2, nrow = 1)
```

#### Determinantes de la promulgación de leyes 

Regresión survival (Periodo 2006 - 2011):

```{r}
ModeloCongreso=data[data$congresoR=='C2006_2011',]
```

```{r}
ModeloCongreso = ModeloCongreso[,c(19,21,22,24)]
```

```{r}
library(survival)
ModeloCongreso$survival=with(ModeloCongreso,Surv(TiempoP, as.numeric(Promulgado)))
```

```{r}
modelo1 <- coxph(survival ~ GPOficialista + ProponeEjecutivo,data=ModeloCongreso)
summary(modelo1)

```

```{r}
library(ggplot2)
library(ggfortify)
KM.fondos = survfit(survival ~ GPOficialista, data = ModeloCongreso)

###
ejeX='TIEMPO HASTA QUE SE PUBLICA EL PROYECTO\n curva cae cuando el proyecto es publicado'
ejeY='Probabilidad de que el proyecto sea publicado'
titulo="Curva de Sobrevivencia (2006 - 2011)"
autoplot(KM.fondos,
         xlab=ejeX,
         ylab=ejeY, 
         main = titulo,
         conf.int = F)
```

```{r}
library(ggplot2)
library(ggfortify)
KM.fondos = survfit(survival ~ ProponeEjecutivo, data = ModeloCongreso)

###
ejeX='TIEMPO HASTA QUE SE PUBLICA EL PROYECTO\n curva cae cuando el proyecto es publicado'
ejeY='Probabilidad de que el proyecto sea publicado'
titulo="Curva de Sobrevivencia (2006 - 2011)"
autoplot(KM.fondos,
         xlab=ejeX,
         ylab=ejeY, 
         main = titulo,
         conf.int = F)
```

<a id='P2011'></a> 

###  Análisis periodo 2011-2016

#### Proponentes

La siguiente tabla muestra el número de leyes propuestas por tipo de proponente y el número de leyes promulgadas por tipo de proponente. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
proponentes1 = data %>% filter(congresoR=="C2011_2016") %>% group_by(proponenteR)  %>% summarise(N_Leyes=n())

proponentes2 = data %>% filter(congresoR=="C2011_2016" & Promulgado=="1") %>% group_by(proponenteR)  %>% summarise(N_Leyes_Promulgadas=n())

proponentes= left_join(proponentes1, proponentes2)
proponentes$N_Leyes_Promulgadas[is.na(proponentes$N_Leyes_Promulgadas)]=0
proponentes=proponentes[order(-proponentes$N_Leyes),]
proponentes=proponentes[complete.cases(proponentes),]

datatable(proponentes, options=list(pageLength=5, scrollX="500px"))
```

El siguiente gráfico muestra el estado de las leyes propuestas por tipo de proponente. 

```{r include=FALSE}
proponentes = proponentes  %>% 
         mutate(N_Leyes_NoPromulgadas = N_Leyes - N_Leyes_Promulgadas,
                Promulgadas = (N_Leyes_Promulgadas/N_Leyes)*100,
                NoPromulgadas = (N_Leyes_NoPromulgadas/N_Leyes)*100)

proponentes$orden=c(1:16)

proponentes = gather(proponentes, Estado, value=Porcentaje, Promulgadas, NoPromulgadas)

proponentes$Porcentaje[proponentes$Porcentaje==0] = NA
```

```{r fig.height = 4, echo=FALSE, fig.width=8.5, warning=FALSE}
ggplot(proponentes, aes(x = reorder(proponenteR,-orden), y = Porcentaje, fill = Estado)) + 
  geom_bar(stat = "identity") + coord_flip() +
  geom_text(aes(label=paste0(round(Porcentaje,1), "%")), position=position_stack(vjust=0.5), vjust = .5, size = 3, col="white") + labs(title="Estado de leyes propuestas por proponente (2011-2016)", y="Porcentaje (%)", x="Tipo de proponente") + theme(plot.title = element_text(hjust = 0.5)) +
    	    theme(panel.background=element_rect(fill = "white", colour = "black"))
```

El siguiente gráfico muestra el tiempo promedio para que una ley sea promulgada por tipo de proponente [Se consideran únicamente a las leyes promulgadas para el análisis].

```{r include=FALSE}
#Promedios: 
meanTiempo = data %>% filter(congresoR=="C2011_2016" & Promulgado=="1") %>% 
  group_by(proponenteR) %>% 
  summarise(Leyes = n(),
            Tiempo = mean(as.numeric(TiempoP)), 
            seTiempo = seMean(as.numeric(TiempoP)))
meanTiempo=meanTiempo[order(-meanTiempo$Leyes),]
```


```{r fig.height = 4, echo=FALSE,warning=FALSE}
ggplot(meanTiempo, aes(x=proponenteR, y=Tiempo)) + 
    geom_errorbar(aes(ymin=Tiempo-seTiempo, ymax=Tiempo+seTiempo), width=.1) +
    geom_point()+ labs(title="Tiempo promedio para promulgar una ley por proponente (2011-2016)", y="Tiempo promedio (semanas)", x="Proponente", caption="Tiempo promedio: 67.8 semanas") + theme(plot.title = element_text(hjust = 0.5)) + theme(panel.background=element_rect(fill = "white", colour = "black")) + theme(axis.text.x = element_text(angle = 90, hjust = 1))+ geom_hline(yintercept = mean(meanTiempo$Tiempo) ,linetype="dashed", color="red")

```

#### Grupos parlamentarios 

```{r echo=FALSE, message=FALSE, warning=FALSE}
proponentes1 = data %>% filter(congresoR=="C2011_2016") %>% group_by(grupoParlamentarioR)  %>% summarise(N_Leyes=n())

proponentes2 = data %>% filter(congresoR=="C2011_2016" & Promulgado=="1") %>% group_by(grupoParlamentarioR)  %>% summarise(N_Leyes_Promulgadas=n())

proponentes= left_join(proponentes1, proponentes2)
proponentes$N_Leyes_Promulgadas[is.na(proponentes$N_Leyes_Promulgadas)]=0
proponentes=proponentes[order(-proponentes$N_Leyes),]
proponentes=proponentes[complete.cases(proponentes),]

datatable(proponentes, options=list(pageLength=5, scrollX="500px"))
```

El siguiente gráfico muestra el estado de las leyes propuestas por grupo parlamentario.

```{r include=FALSE}
proponentes = proponentes  %>% 
         mutate(N_Leyes_NoPromulgadas = N_Leyes - N_Leyes_Promulgadas,
                Promulgadas = (N_Leyes_Promulgadas/N_Leyes)*100,
                NoPromulgadas = (N_Leyes_NoPromulgadas/N_Leyes)*100)

proponentes$orden=c(1:16)

proponentes = gather(proponentes, Estado, value=Porcentaje, Promulgadas, NoPromulgadas)

proponentes$Porcentaje[proponentes$Porcentaje==0] = NA
```

```{r fig.height = 4, echo=FALSE, fig.width=8.5, warning=FALSE}
ggplot(proponentes, aes(x = reorder(grupoParlamentarioR,-orden), y = Porcentaje, fill = Estado)) + 
  geom_bar(stat = "identity") + coord_flip() +
  geom_text(aes(label=paste0(round(Porcentaje,1), "%")), position=position_stack(vjust=0.5), vjust = .5, size = 3, col="white") + labs(title="Estado de leyes propuestas por grupo parlamentario (2011-2016)", y="Porcentaje (%)", x="Tipo de proponente") + theme(plot.title = element_text(hjust = 0.5)) +
    	    theme(panel.background=element_rect(fill = "white", colour = "black"))
```

El siguiente gráfico muestra el tiempo promedio para que una ley sea promulgada por grupo parlamentario [Se consideran únicamente a las leyes promulgadas para el análisis].

```{r include=FALSE}
#Promedios: 
meanTiempo = data %>% filter(congresoR=="C2011_2016" & Promulgado=="1") %>% 
  group_by(grupoParlamentarioR) %>% 
  summarise(Leyes = n(),
            Tiempo = mean(as.numeric(TiempoP)), 
            seTiempo = seMean(as.numeric(TiempoP)))
meanTiempo=meanTiempo[order(-meanTiempo$Leyes),]
```

```{r fig.height = 6, echo=FALSE,warning=FALSE}
ggplot(meanTiempo, aes(x=grupoParlamentarioR, y=Tiempo)) + 
    geom_errorbar(aes(ymin=Tiempo-seTiempo, ymax=Tiempo+seTiempo), width=.1) +
    geom_point()+ labs(title="Tiempo promedio para promulgar una ley por Grupo Parlamentario (2011-2016)", y="Tiempo promedio (semanas)", x="Grupo Parlamentario", caption="Tiempo promedio: 45 semanas") + theme(plot.title = element_text(hjust = 0.5)) + theme(panel.background=element_rect(fill = "white", colour = "black")) + theme(axis.text.x = element_text(angle = 90, hjust = 1))+ geom_hline(yintercept = mean(meanTiempo$Tiempo) ,linetype="dashed", color="red")

```

#### Análisis del contenido de Leyes Propuestas

```{r include=FALSE}
dataText = data %>% filter(congresoR=="C2011_2016" & Promulgado=="1") %>% select(sumilla)
modi<-Corpus(VectorSource(dataText$sumilla))
```

```{r include=FALSE}
modi_data<-tm_map(modi,stripWhitespace)
modi_data<-tm_map(modi_data,tolower)
modi_data<-tm_map(modi_data,removeNumbers)
modi_data<-tm_map(modi_data,removePunctuation)
modi_data<-tm_map(modi_data,removeWords, stopwords("spanish"))
```

```{r include=FALSE}
modi_data<-tm_map(modi_data, removeWords, c("ley", "articulo", "decreto", "legislativo", "modificado", "modifica", "proyecto", "general", "modificando", "codigo", "articulos", "estableciendo", "republica", "referente", "inciso", "peru", "comision", "establece", "organica", "fin", "anos", "plazo", "ano", "declarando", "plazo", "diciembre", "presente", "parrafo", "texto", "creando", "derogando", "cada", "dos", "seran", "mas", "cargo", "refiere", "declara", "autoriza", "partir", "referido", "forma", "deroga", "actos", "dia", "supremo", "final", "san", "dicha", "caso", "nacional", "ser", "asi", "mismo", "titulo", "toda", "todo", "prorroga", "publico", "publica", "acuerdo", "poder", "vigencia", "dias", "disposicion", "propone", "modificar", "num", "propuesta", "incorporar", "declarar", "establecer", "autorizar", "crear", "interes", "necesidad"))
```

```{r include=FALSE}
dtm <- TermDocumentMatrix(modi_data)
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v)
d=d[c(1:20),]
d=d[order(-d$freq),]
d$orden=c(1:20)
```

```{r include=FALSE}
dataText = data %>% filter(congresoR=="C2011_2016" & Promulgado=="0") %>% select(sumilla)
modi<-Corpus(VectorSource(dataText$sumilla))
```

```{r include=FALSE}
modi_data<-tm_map(modi,stripWhitespace)
modi_data<-tm_map(modi_data,tolower)
modi_data<-tm_map(modi_data,removeNumbers)
modi_data<-tm_map(modi_data,removePunctuation)
modi_data<-tm_map(modi_data,removeWords, stopwords("spanish"))
```

```{r include=FALSE}
modi_data<-tm_map(modi_data, removeWords, c("ley", "articulo", "decreto", "legislativo", "modificado", "modifica", "proyecto", "general", "modificando", "codigo", "articulos", "estableciendo", "republica", "referente", "inciso", "peru", "comision", "establece", "organica", "fin", "anos", "plazo", "ano", "declarando", "plazo", "diciembre", "presente", "parrafo", "texto", "creando", "derogando", "cada", "dos", "seran", "mas", "cargo", "refiere", "declara", "autoriza", "partir", "referido", "forma", "deroga", "actos", "dia", "supremo", "final", "san", "dicha", "caso", "nacional", "ser", "asi", "mismo", "titulo", "toda", "todo", "prorroga", "publico", "publica", "acuerdo", "poder", "vigencia", "dias", "disposicion", "propone", "modificar", "num", "propuesta", "incorporar", "declarar", "establecer", "autorizar", "crear", "interes", "necesidad"))
```

```{r include=FALSE}
dtm <- TermDocumentMatrix(modi_data)
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
d2 <- data.frame(word = names(v),freq=v)
d2=d2[c(1:20),]
d2=d2[order(-d2$freq),]
d2$orden=c(1:20)
```

```{r fig.height = 4.5, echo=FALSE,warning=FALSE}
m1= ggplot(d, aes(x = reorder(word,-orden), y = freq)) +
  geom_bar(stat="identity", fill="darkgrey") + labs(title="Leyes Promulgadas", y="Numero de menciones", x="") +
    	    theme(panel.background=element_rect(fill = "white", colour = "black")) + coord_flip()

m2= ggplot(d2, aes(x = reorder(word,-orden), y = freq)) +
  geom_bar(stat="identity", fill="darkgrey") + labs(title="Leyes No Promulgadas", y="Numero de menciones", x="") +
    	    theme(panel.background=element_rect(fill = "white", colour = "black")) + coord_flip() + scale_y_continuous(breaks = seq(0, 250, by = 50))

ggarrange(m1,m2, ncol = 2, nrow = 1)
```

#### Determinantes de la promulgación de leyes 

Regresión survival (Periodo 2011 - 2016):

```{r}
ModeloCongreso=data[data$congresoR=='C2011_2016',]
```

```{r}
ModeloCongreso = ModeloCongreso[,c(19,21,22,24)]
```

```{r}
library(survival)
ModeloCongreso$survival=with(ModeloCongreso,Surv(TiempoP, as.numeric(Promulgado)))
```

```{r}
modelo1 <- coxph(survival ~ GPOficialista + ProponeEjecutivo,data=ModeloCongreso)
summary(modelo1)

```

```{r}
library(ggplot2)
library(ggfortify)
KM.fondos = survfit(survival ~ GPOficialista, data = ModeloCongreso)

###
ejeX='TIEMPO HASTA QUE SE PUBLICA EL PROYECTO\n curva cae cuando el proyecto es publicado'
ejeY='Probabilidad de que el proyecto sea publicado'
titulo="Curva de Sobrevivencia (2011 - 2016)"
autoplot(KM.fondos,
         xlab=ejeX,
         ylab=ejeY, 
         main = titulo,
         conf.int = F)
```

```{r}
library(ggplot2)
library(ggfortify)
KM.fondos = survfit(survival ~ ProponeEjecutivo, data = ModeloCongreso)

###
ejeX='TIEMPO HASTA QUE SE PUBLICA EL PROYECTO\n curva cae cuando el proyecto es publicado'
ejeY='Probabilidad de que el proyecto sea publicado'
titulo="Curva de Sobrevivencia (2011 - 2016)"
autoplot(KM.fondos,
         xlab=ejeX,
         ylab=ejeY, 
         main = titulo,
         conf.int = F)
```

<a id='P2016'></a> 

###  Análisis periodo 2016-2021

#### Proponentes

La siguiente tabla muestra el número de leyes propuestas por tipo de proponente y el número de leyes promulgadas por tipo de proponente. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
proponentes1 = data %>% filter(congresoR=="C2016_2021") %>% group_by(proponenteR)  %>% summarise(N_Leyes=n())

proponentes2 = data %>% filter(congresoR=="C2016_2021" & Promulgado=="1") %>% group_by(proponenteR)  %>% summarise(N_Leyes_Promulgadas=n())

proponentes= left_join(proponentes1, proponentes2)
proponentes$N_Leyes_Promulgadas[is.na(proponentes$N_Leyes_Promulgadas)]=0
proponentes=proponentes[order(-proponentes$N_Leyes),]
proponentes=proponentes[complete.cases(proponentes),]

datatable(proponentes, options=list(pageLength=5, scrollX="500px"))
```

El siguiente gráfico muestra el estado de las leyes propuestas por tipo de proponente. 

```{r include=FALSE}
proponentes = proponentes  %>% 
         mutate(N_Leyes_NoPromulgadas = N_Leyes - N_Leyes_Promulgadas,
                Promulgadas = (N_Leyes_Promulgadas/N_Leyes)*100,
                NoPromulgadas = (N_Leyes_NoPromulgadas/N_Leyes)*100)

proponentes$orden=c(1:13)

proponentes = gather(proponentes, Estado, value=Porcentaje, Promulgadas, NoPromulgadas)

proponentes$Porcentaje[proponentes$Porcentaje==0] = NA
```

```{r fig.height = 4, echo=FALSE, fig.width=8.5, warning=FALSE}
ggplot(proponentes, aes(x = reorder(proponenteR,-orden), y = Porcentaje, fill = Estado)) + 
  geom_bar(stat = "identity") + coord_flip() +
  geom_text(aes(label=paste0(round(Porcentaje,1), "%")), position=position_stack(vjust=0.5), vjust = .5, size = 3, col="white") + labs(title="Estado de leyes propuestas por proponente (2016-2021)", y="Porcentaje (%)", x="Tipo de proponente") + theme(plot.title = element_text(hjust = 0.5)) +
    	    theme(panel.background=element_rect(fill = "white", colour = "black"))
```

El siguiente gráfico muestra el tiempo promedio para que una ley sea promulgada por tipo de proponente [Se consideran únicamente a las leyes promulgadas para el análisis].

```{r include=FALSE}
#Promedios: 
meanTiempo = data %>% filter(congresoR=="C2016_2021" & Promulgado=="1") %>% 
  group_by(proponenteR) %>% 
  summarise(Leyes = n(),
            Tiempo = mean(as.numeric(TiempoP)), 
            seTiempo = seMean(as.numeric(TiempoP)))
meanTiempo=meanTiempo[order(-meanTiempo$Leyes),]
```


```{r fig.height = 4, echo=FALSE,warning=FALSE}
ggplot(meanTiempo, aes(x=proponenteR, y=Tiempo)) + 
    geom_errorbar(aes(ymin=Tiempo-seTiempo, ymax=Tiempo+seTiempo), width=.1) +
    geom_point()+ labs(title="Tiempo promedio para promulgar una ley por proponente (2016-2021)", y="Tiempo promedio (semanas)", x="Proponente", caption="Tiempo promedio: 46.1 semanas") + theme(plot.title = element_text(hjust = 0.5)) + theme(panel.background=element_rect(fill = "white", colour = "black")) + theme(axis.text.x = element_text(angle = 90, hjust = 1))+ geom_hline(yintercept = mean(meanTiempo$Tiempo) ,linetype="dashed", color="red")

```

#### Grupos parlamentarios 

```{r echo=FALSE, message=FALSE, warning=FALSE}
proponentes1 = data %>% filter(congresoR=="C2016_2021") %>% group_by(grupoParlamentarioR)  %>% summarise(N_Leyes=n())

proponentes2 = data %>% filter(congresoR=="C2016_2021" & Promulgado=="1") %>% group_by(grupoParlamentarioR)  %>% summarise(N_Leyes_Promulgadas=n())

proponentes= left_join(proponentes1, proponentes2)
proponentes$N_Leyes_Promulgadas[is.na(proponentes$N_Leyes_Promulgadas)]=0
proponentes=proponentes[order(-proponentes$N_Leyes),]
proponentes=proponentes[complete.cases(proponentes),]

datatable(proponentes, options=list(pageLength=5, scrollX="500px"))
```

El siguiente gráfico muestra el estado de las leyes propuestas por grupo parlamentario.

```{r include=FALSE}
proponentes = proponentes  %>% 
         mutate(N_Leyes_NoPromulgadas = N_Leyes - N_Leyes_Promulgadas,
                Promulgadas = (N_Leyes_Promulgadas/N_Leyes)*100,
                NoPromulgadas = (N_Leyes_NoPromulgadas/N_Leyes)*100)

proponentes$orden=c(1:10)

proponentes = gather(proponentes, Estado, value=Porcentaje, Promulgadas, NoPromulgadas)

proponentes$Porcentaje[proponentes$Porcentaje==0] = NA
```

```{r fig.height = 4, echo=FALSE, fig.width=8.5, warning=FALSE}
ggplot(proponentes, aes(x = reorder(grupoParlamentarioR,-orden), y = Porcentaje, fill = Estado)) + 
  geom_bar(stat = "identity") + coord_flip() +
  geom_text(aes(label=paste0(round(Porcentaje,1), "%")), position=position_stack(vjust=0.5), vjust = .5, size = 3, col="white") + labs(title="Estado de leyes propuestas por grupo parlamentario (2016-2021)", y="Porcentaje (%)", x="Tipo de proponente") + theme(plot.title = element_text(hjust = 0.5)) +
    	    theme(panel.background=element_rect(fill = "white", colour = "black"))
```

El siguiente gráfico muestra el tiempo promedio para que una ley sea promulgada por grupo parlamentario [Se consideran únicamente a las leyes promulgadas para el análisis].

```{r include=FALSE}
#Promedios: 
meanTiempo = data %>% filter(congresoR=="C2016_2021" & Promulgado=="1") %>% 
  group_by(grupoParlamentarioR) %>% 
  summarise(Leyes = n(),
            Tiempo = mean(as.numeric(TiempoP)), 
            seTiempo = seMean(as.numeric(TiempoP)))
meanTiempo=meanTiempo[order(-meanTiempo$Leyes),]
```

```{r fig.height = 6, echo=FALSE,warning=FALSE}
ggplot(meanTiempo, aes(x=grupoParlamentarioR, y=Tiempo)) + 
    geom_errorbar(aes(ymin=Tiempo-seTiempo, ymax=Tiempo+seTiempo), width=.1) +
    geom_point()+ labs(title="Tiempo promedio para promulgar una ley por Grupo Parlamentario (2016-2021)", y="Tiempo promedio (semanas)", x="Grupo Parlamentario", caption="Tiempo promedio: 32 semanas") + theme(plot.title = element_text(hjust = 0.5)) + theme(panel.background=element_rect(fill = "white", colour = "black")) + theme(axis.text.x = element_text(angle = 90, hjust = 1))+ geom_hline(yintercept = mean(meanTiempo$Tiempo) ,linetype="dashed", color="red")

```

#### Análisis del contenido de Leyes Propuestas

```{r include=FALSE}
dataText = data %>% filter(congresoR=="C2016_2021" & Promulgado=="1") %>% select(sumilla)
modi<-Corpus(VectorSource(dataText$sumilla))
```

```{r include=FALSE}
modi_data<-tm_map(modi,stripWhitespace)
modi_data<-tm_map(modi_data,tolower)
modi_data<-tm_map(modi_data,removeNumbers)
modi_data<-tm_map(modi_data,removePunctuation)
modi_data<-tm_map(modi_data,removeWords, stopwords("spanish"))
```

```{r include=FALSE}
modi_data<-tm_map(modi_data, removeWords, c("ley", "articulo", "decreto", "legislativo", "modificado", "modifica", "proyecto", "general", "modificando", "codigo", "articulos", "estableciendo", "republica", "referente", "inciso", "peru", "comision", "establece", "organica", "fin", "anos", "plazo", "ano", "declarando", "plazo", "diciembre", "presente", "parrafo", "texto", "creando", "derogando", "cada", "dos", "seran", "mas", "cargo", "refiere", "declara", "autoriza", "partir", "referido", "forma", "deroga", "actos", "dia", "supremo", "final", "san", "dicha", "caso", "nacional", "ser", "asi", "mismo", "titulo", "toda", "todo", "prorroga", "publico", "publica", "acuerdo", "poder", "vigencia", "dias", "disposicion", "propone", "modificar", "num", "propuesta", "incorporar", "declarar", "establecer", "autorizar", "crear", "interes", "necesidad"))
```

```{r include=FALSE}
dtm <- TermDocumentMatrix(modi_data)
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v)
d=d[c(1:20),]
d=d[order(-d$freq),]
d$orden=c(1:20)
```

```{r include=FALSE}
dataText = data %>% filter(congresoR=="C2016_2021" & Promulgado=="0") %>% select(sumilla)
modi<-Corpus(VectorSource(dataText$sumilla))
```

```{r include=FALSE}
modi_data<-tm_map(modi,stripWhitespace)
modi_data<-tm_map(modi_data,tolower)
modi_data<-tm_map(modi_data,removeNumbers)
modi_data<-tm_map(modi_data,removePunctuation)
modi_data<-tm_map(modi_data,removeWords, stopwords("spanish"))
```

```{r include=FALSE}
modi_data<-tm_map(modi_data, removeWords, c("ley", "articulo", "decreto", "legislativo", "modificado", "modifica", "proyecto", "general", "modificando", "codigo", "articulos", "estableciendo", "republica", "referente", "inciso", "peru", "comision", "establece", "organica", "fin", "anos", "plazo", "ano", "declarando", "plazo", "diciembre", "presente", "parrafo", "texto", "creando", "derogando", "cada", "dos", "seran", "mas", "cargo", "refiere", "declara", "autoriza", "partir", "referido", "forma", "deroga", "actos", "dia", "supremo", "final", "san", "dicha", "caso", "nacional", "ser", "asi", "mismo", "titulo", "toda", "todo", "prorroga", "publico", "publica", "acuerdo", "poder", "vigencia", "dias", "disposicion", "propone", "modificar", "num", "propuesta", "incorporar", "declarar", "establecer", "autorizar", "crear", "interes", "necesidad"))
```

```{r include=FALSE}
dtm <- TermDocumentMatrix(modi_data)
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
d2 <- data.frame(word = names(v),freq=v)
d2=d2[c(1:20),]
d2=d2[order(-d2$freq),]
d2$orden=c(1:20)
```

```{r fig.height = 4.5, echo=FALSE,warning=FALSE}
m1= ggplot(d, aes(x = reorder(word,-orden), y = freq)) +
  geom_bar(stat="identity", fill="darkgrey") + labs(title="Leyes Promulgadas", y="Numero de menciones", x="") +
    	    theme(panel.background=element_rect(fill = "white", colour = "black")) + coord_flip()

m2= ggplot(d2, aes(x = reorder(word,-orden), y = freq)) +
  geom_bar(stat="identity", fill="darkgrey") + labs(title="Leyes No Promulgadas", y="Numero de menciones", x="") +
    	    theme(panel.background=element_rect(fill = "white", colour = "black")) + coord_flip() + scale_y_continuous(breaks = seq(0, 250, by = 50))

ggarrange(m1,m2, ncol = 2, nrow = 1)
```

#### Determinantes de la promulgación de leyes 

Regresión survival (Periodo 2016 - 2021):

```{r}
ModeloCongreso=data[data$congresoR=='C2016_2021',]
```

```{r}
ModeloCongreso = ModeloCongreso[,c(19,21,22,24)]
```

```{r}
library(survival)
ModeloCongreso$survival=with(ModeloCongreso,Surv(TiempoP, as.numeric(Promulgado)))
```

```{r}
modelo1 <- coxph(survival ~ GPOficialista + ProponeEjecutivo,data=ModeloCongreso)
summary(modelo1)
```

```{r}
library(ggplot2)
library(ggfortify)
KM.fondos = survfit(survival ~ GPOficialista, data = ModeloCongreso)

###
ejeX='TIEMPO HASTA QUE SE PUBLICA EL PROYECTO\n curva cae cuando el proyecto es publicado'
ejeY='Probabilidad de que el proyecto sea publicado'
titulo="Curva de Sobrevivencia (2016 - 2021)"
autoplot(KM.fondos,
         xlab=ejeX,
         ylab=ejeY, 
         main = titulo,
         conf.int = F)
```

```{r}
library(ggplot2)
library(ggfortify)
KM.fondos = survfit(survival ~ ProponeEjecutivo, data = ModeloCongreso)

###
ejeX='TIEMPO HASTA QUE SE PUBLICA EL PROYECTO\n curva cae cuando el proyecto es publicado'
ejeY='Probabilidad de que el proyecto sea publicado'
titulo="Curva de Sobrevivencia (2016 - 2021)"
autoplot(KM.fondos,
         xlab=ejeX,
         ylab=ejeY, 
         main = titulo,
         conf.int = F)

```
------

<a id='team'></a>

**El equipo del LabPUCP est?? conformado por:**

- Director: Dr. Jos?? Manuel Magallanes

- Investigadora Senior: Lic. Mar??a Gracia Becerra

- Investigador Junior: Alexander Benites
